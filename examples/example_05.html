
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Conditions &#8212; re2c 1.2 documentation</title>
    <link rel="stylesheet" href="../_static/theme-re2c.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="alternate" type="application/atom+xml" href="../feed/atom.xml" title="Atom 1.0" />
    
 
  </head><body>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="re2c-logo">
    re2c
</div>

<h3><a href="../index.html">Home</a></h3>
<div class="re2c-toc-global">
    <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../manual/manual.html">User manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Build instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/changelog/changelog.html">Changelog</a></li>
</ul>

</div>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="conditions">
<h1>Conditions<a class="headerlink" href="#conditions" title="Permalink to this headline">Â¶</a></h1>
<p>This example demonstrates the use of conditions.
It is similar in functionality to the <a class="reference external" href="example_04.html">Multiple blocks</a> example,
except that individual sub-lexers are connected usding conditions rather than multiple blocks.
Conditions allow to encode multiple interconnected lexers within a single re2c block.</p>
<p><a class="reference download internal" href="../_downloads/05_parsing_integers_conditions.ci.re" download=""><code class="xref download docutils literal notranslate"><span class="pre">[conditions.re]</span></code></a></p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;limits.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="k">template</span><span class="o">&lt;</span><span class="kt">int</span> <span class="n">base</span><span class="o">&gt;</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="n">adddgt</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">ULONG_MAX</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">base</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span> <span class="n">base</span> <span class="o">+</span> <span class="n">d</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*!types:re2c*/</span>

<span class="k">static</span> <span class="kt">bool</span> <span class="n">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCTXMARKER</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">yycinit</span><span class="p">;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="cm">/*!re2c</span>
<span class="cm">        re2c:yyfill:enable = 0;</span>
<span class="cm">        re2c:define:YYCTYPE = char;</span>
<span class="cm">        re2c:define:YYCURSOR = s;</span>
<span class="cm">        re2c:define:YYGETCONDITION = &quot;c&quot;;</span>
<span class="cm">        re2c:define:YYGETCONDITION:naked = 1;</span>
<span class="cm">        re2c:define:YYSETCONDITION = &quot;c = @@;&quot;;</span>
<span class="cm">        re2c:define:YYSETCONDITION:naked = 1;</span>

<span class="cm">        &lt;*&gt; * { return false; }</span>

<span class="cm">        &lt;init&gt; &#39;0b&#39; / [01]        :=&gt; bin</span>
<span class="cm">        &lt;init&gt; &quot;0&quot;                :=&gt; oct</span>
<span class="cm">        &lt;init&gt; &quot;&quot; / [1-9]         :=&gt; dec</span>
<span class="cm">        &lt;init&gt; &#39;0x&#39; / [0-9a-fA-F] :=&gt; hex</span>

<span class="cm">        &lt;bin, oct, dec, hex&gt; &quot;\x00&quot; { return true; }</span>
<span class="cm">        &lt;bin&gt; [01]  { if (!adddgt&lt;2&gt;(u, s[-1] - &#39;0&#39;)) return false; goto yyc_bin; }</span>
<span class="cm">        &lt;oct&gt; [0-7] { if (!adddgt&lt;8&gt;(u, s[-1] - &#39;0&#39;)) return false; goto yyc_oct; }</span>
<span class="cm">        &lt;dec&gt; [0-9] { if (!adddgt&lt;10&gt;(u, s[-1] - &#39;0&#39;)) return false; goto yyc_dec; }</span>
<span class="cm">        &lt;hex&gt; [0-9] { if (!adddgt&lt;16&gt;(u, s[-1] - &#39;0&#39;))      return false; goto yyc_hex; }</span>
<span class="cm">        &lt;hex&gt; [a-f] { if (!adddgt&lt;16&gt;(u, s[-1] - &#39;a&#39; + 10)) return false; goto yyc_hex; }</span>
<span class="cm">        &lt;hex&gt; [A-F] { if (!adddgt&lt;16&gt;(u, s[-1] - &#39;A&#39; + 10)) return false; goto yyc_hex; }</span>
<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">u</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Notes:</p>
<ul class="simple">
<li>Conditions are enabled with the <code class="docutils literal notranslate"><span class="pre">-c</span></code> option.</li>
<li>Conditions are only syntactic sugar; they can be translated into multiple blocks.</li>
<li>Each condition is a standalone lexer (DFA).</li>
<li>Each condition has a unique identifier: <code class="docutils literal notranslate"><span class="pre">/*!types:re2c*/</span></code> tells re2c to generate
an enumeration of all the identifiers (the names are prefixed with <code class="docutils literal notranslate"><span class="pre">yyc</span></code> by default).
The lexer uses <code class="docutils literal notranslate"><span class="pre">YYGETCONDITION</span></code> to get the identifier of the current condition
and <code class="docutils literal notranslate"><span class="pre">YYSETCONDITION</span></code> to set it.</li>
<li>Each condition has a unique label (prefixed with <code class="docutils literal notranslate"><span class="pre">yyc_</span></code> by default).</li>
<li>Conditions are connected: transitions are allowed between the final states of one condition
and the start state of another condition (but not between inner states of different conditions).
The generated code starts with dispatch.
Actions can either jump to the initial dispatch or jump directly to a condition.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">&lt;*&gt;</span></code> rule is merged to all conditions (low priority).</li>
<li>Rules with multiple conditions are merged to each listed condition (normal priority).</li>
<li><code class="docutils literal notranslate"><span class="pre">:=&gt;</span></code> jumps directly to the next condition (bypassing the initial dispatch).</li>
</ul>
<p>Compile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ re2c -c -o conditions.cc conditions.re
$ g++ -o conditions conditions.cc
</pre></div>
</div>
<p>Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./conditions <span class="m">0</span> <span class="m">12345678901234567890</span> 0xFFFFffffFFFFffff 0x1FFFFffffFFFFffff 0xAbcDEf 0x00 <span class="m">007</span> 0B0 0b110101010 <span class="s2">&quot;&quot;</span>
<span class="m">0</span>
<span class="m">12345678901234567890</span>
<span class="m">18446744073709551615</span>
error
<span class="m">11259375</span>
<span class="m">0</span>
<span class="m">7</span>
<span class="m">0</span>
<span class="m">426</span>
error
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
      Last updated on Dec 27, 2019.
    </div>
  </body>
</html>